{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/js/izi-toast.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nconst API_KEY = '52933898-64c235b98ac290495c49a4d77';\nconst BASE_URL = 'https://pixabay.com/api/';\n\n/**\n * Получает массив изображений по запросу и номеру страницы\n * @param {string} query - слово для поиска\n * @param {number} page - номер страницы\n * @returns {Promise<Array>} - массив объектов изображений\n */\nexport async function fetchImages(query, page = 1) {\n  const params = {\n    key: API_KEY,\n    q: query,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 15,\n    page,\n  };\n\n  const response = await axios.get(BASE_URL, { params });\n  return {\n    images: response.data.hits,\n    totalHits: response.data.totalHits,\n  };\n}\n","/**\n * Создаёт HTML-разметку картинок\n * @param {Array} images\n * @returns {string} HTML\n */\nexport function createGalleryMarkup(images) {\n  return images\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => `\n      <li class=\"card\">\n        <a href=\"${largeImageURL}\" target=\"_blank\" rel=\"noopener noreferrer\">\n          <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\n        </a>\n        <div class=\"stats\">\n          <div><span>Likes</span>${likes}</div>\n          <div><span>Views</span>${views}</div>\n          <div><span>Comments</span>${comments}</div>\n          <div><span>Downloads</span>${downloads}</div>\n        </div>\n      </li>`\n    )\n    .join('');\n}\n\n/**\n * Очищает галерею\n */\nexport function clearGallery() {\n  document.querySelector('.gallery').innerHTML = '';\n}\n\n/**\n * Отображает разметку в галерее\n * @param {string} markup - HTML строка\n * @param {boolean} append - если true, добавляет к существующим картинкам\n */\nexport function renderGallery(markup, append = false) {\n  const gallery = document.querySelector('.gallery');\n  if (append) {\n    gallery.insertAdjacentHTML('beforeend', markup);\n  } else {\n    gallery.innerHTML = markup;\n  }\n}\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\n// Ошибка\nexport const errorToast = msg => {\n  return iziToast.show({\n    class: 'custom-error-toast',\n    timeout: 4000,\n    close: true,\n    overlay: false,\n    position: 'topRight',\n    title: '',\n    message: msg,\n    progressBar: false,\n    transitionIn: 'fadeInDown',\n    transitionOut: 'fadeOutUp',\n    closeOnClick: true,\n  });\n};\n\n// Info\nexport const infoToast = msg => {\n  return iziToast.show({\n    class: 'custom-info-toast',\n    timeout: 3000,\n    close: true,\n    overlay: false,\n    position: 'topRight',\n    title: '',\n    message: msg,\n    progressBar: false,\n    transitionIn: 'fadeInDown',\n    transitionOut: 'fadeOutUp',\n    closeOnClick: true,\n  });\n};\n","// ================================\n// Импорты\n// ================================\nimport { fetchImages } from './js/pixabay-api.js'; // HTTP-запросы к Pixabay через Axios\nimport {\n  createGalleryMarkup,\n  clearGallery,\n  renderGallery,\n} from './js/render-functions.js'; // функции для отображения картинок\nimport { errorToast, infoToast } from './js/izi-toast.js'; // уведомления\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\n// ================================\n// Переменные DOM\n// ================================\nconst form = document.querySelector('.form');\nconst loader = document.querySelector('.loader');\nconst gallery = document.querySelector('.gallery');\nconst loadMoreBtn = document.querySelector('.load-more');\n\n// ================================\n// Настройка Lightbox\n// ================================\nlet lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\n// ================================\n// Переменные состояния\n// ================================\nlet currentPage = 1;\nlet currentQuery = '';\nlet totalHits = 0;\nlet loadedImages = 0;\n\n// ================================\n// События\n// ================================\nform.addEventListener('submit', onSearch);\nloadMoreBtn.addEventListener('click', onLoadMore);\n\n// ================================\n// Функция поиска картинок\n// ================================\nasync function onSearch(event) {\n  event.preventDefault();\n\n  currentQuery = event.target.elements.search.value.trim();\n  if (!currentQuery) {\n    infoToast('Please, enter a search query!');\n    return;\n  }\n\n  // сброс галереи и состояния\n  clearGallery();\n  currentPage = 1;\n  loadedImages = 0;\n  loader.classList.add('active');\n  loadMoreBtn.style.display = 'none';\n\n  try {\n    // получаем картинки с API\n    const { images, totalHits: total } = await fetchImages(\n      currentQuery,\n      currentPage\n    );\n\n    if (images.length === 0) {\n      infoToast('Sorry, there are no images matching your search query.');\n      return;\n    }\n\n    totalHits = total;\n    loadedImages = images.length;\n\n    renderGallery(createGalleryMarkup(images));\n    lightbox.refresh();\n\n    if (loadedImages < totalHits) {\n      loadMoreBtn.style.display = 'block';\n    }\n  } catch (error) {\n    console.error(error);\n    errorToast('An error occurred while fetching images.');\n  } finally {\n    loader.classList.remove('active');\n  }\n}\n\n// ================================\n// Функция подгрузки следующей страницы\n// ================================\nasync function onLoadMore() {\n  currentPage += 1;\n  loader.classList.add('active');\n  loadMoreBtn.style.display = 'none';\n\n  try {\n    const { images } = await fetchImages(currentQuery, currentPage);\n\n    if (images.length === 0) {\n      infoToast('No more images.');\n      return;\n    }\n\n    loadedImages += images.length;\n\n    renderGallery(createGalleryMarkup(images), true);\n    lightbox.refresh();\n\n    // Плавная прокрутка страницы\n    smoothScroll();\n\n    // Проверяем, достигли ли конца коллекции\n    if (loadedImages >= totalHits) {\n      infoToast(\"We're sorry, but you've reached the end of search results.\");\n      loadMoreBtn.style.display = 'none';\n    } else {\n      loadMoreBtn.style.display = 'block';\n    }\n  } catch (error) {\n    errorToast('An error occurred while fetching images.');\n  } finally {\n    loader.classList.remove('active');\n  }\n}\n\n// ================================\n// Плавная прокрутка страницы\n// ================================\nfunction smoothScroll() {\n  const galleryItems = document.querySelectorAll('.gallery .card');\n  if (galleryItems.length > 0) {\n    const cardHeight = galleryItems[0].getBoundingClientRect().height;\n    window.scrollBy({\n      top: cardHeight * 2,\n      behavior: 'smooth',\n    });\n  }\n}\n"],"names":["API_KEY","BASE_URL","fetchImages","query","page","params","response","axios","createGalleryMarkup","images","webformatURL","largeImageURL","tags","likes","views","comments","downloads","clearGallery","renderGallery","markup","append","gallery","errorToast","msg","iziToast","infoToast","form","loader","loadMoreBtn","lightbox","SimpleLightbox","currentPage","currentQuery","totalHits","loadedImages","onSearch","onLoadMore","event","total","error","smoothScroll","galleryItems","cardHeight"],"mappings":"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"}